#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

include /usr/share/javahelper/java-vars.mk

%:
	dh $@ --with javahelper

%.html: %.md
	pandoc -f gfm -t html $< > $@

HTML_DOCS := docs/reference.html docs/examples.html README.html

override_dh_auto_build: $(HTML_DOCS)
	bazel build //java/com/google/copybara:copybara_deploy.jar
	bazel shutdown
	cp bazel-bin/java/com/google/copybara/copybara_deploy.jar bazel-bin/copybara
	chmod +x bazel-bin/copybara

#override_dh_auto_install:
#       dh_auto_install -- prefix=/usr

#override_dh_install:
#       dh_install --list-missing -X.pyc -X.pyo

override_dh_auto_clean:
	bazel clean
	bazel shutdown
	-rm -rf bazel-*
	-rm -f $(HTML_DOCS)
	dh_auto_clean
