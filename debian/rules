#!/usr/bin/make -f
export DH_VERBOSE = 1

include /usr/share/javahelper/java-vars.mk

%:
	dh $@ --with javahelper

%.html: %.md
	pandoc -f gfm -t html $< > $@

HTML_DOCS := docs/reference.html docs/examples.html README.html

BAZEL_ARGS := --verbose_failures \
              --define=ABSOLUTE_JAVABASE=$(JAVA_HOME) \
              --javabase=@bazel_tools//tools/jdk:absolute_javabase \
              --host_javabase=@bazel_tools//tools/jdk:absolute_javabase \
              --java_toolchain=@bazel_tools//tools/jdk:toolchain_vanilla \
              --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_vanilla \

override_dh_auto_build: $(HTML_DOCS)
	bazel build //java/com/google/copybara:copybara_deploy.jar $(BAZEL_ARGS)
	bazel shutdown

override_dh_auto_clean:
	bazel clean
	bazel shutdown
	-rm -rf bazel-*
	-rm -f $(HTML_DOCS)
	dh_auto_clean
